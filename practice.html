<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>テーブル管理</title>
<style>
  body { font-family: Arial, sans-serif; background: linear-gradient(to bottom, #e0f7fa, #ffffff); padding: 20px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #0097a7; color: white; }
  .vacant { background-color: #b2dfdb; } /* 空席: 緑系 */
  .occupied { background-color: #ef9a9a; } /* 使用中: 赤系 */
  .btn-clear { cursor: pointer; color: blue; text-decoration: underline; }
  .history-section { max-height: 300px; overflow-y: auto; }
  input[type="text"] { padding: 6px; margin-bottom: 10px; width: 200px; }
</style>
</head>
<body>

<h1>テーブル管理</h1>

<section>
  <h2>テーブル一覧</h2>
  <table id="tableStatus">
    <thead>
      <tr><th>テーブルID</th><th>状態</th><th>利用時間</th><th>操作</th></tr>
    </thead>
    <tbody>
      <!-- JSで動的生成 -->
    </tbody>
  </table>
</section>

<section>
  <h2>利用履歴</h2>
  <input type="text" id="searchInput" placeholder="テーブルIDか端末IDで検索" />
  <div class="history-section">
    <table id="usageHistory">
      <thead>
        <tr><th>テーブルID</th><th>開始時刻</th><th>終了時刻</th><th>端末ID</th></tr>
      </thead>
      <tbody>
        <!-- JSで動的生成 -->
      </tbody>
    </table>
  </div>
</section>

<script>
// ダミーデータ（実際はFirebaseやAPIから取得）
const tables = [
  { id: "T1", status: "vacant", usageStart: null, deviceId: null },
  { id: "T2", status: "occupied", usageStart: Date.now() - 3600 * 1000, deviceId: "device123" },
  { id: "T3", status: "vacant", usageStart: null, deviceId: null },
];

const usageLogs = [
  { tableId: "T1", start: "2025-06-01 12:00", end: "2025-06-01 13:00", deviceId: "deviceA" },
  { tableId: "T2", start: "2025-06-02 09:30", end: "2025-06-02 10:15", deviceId: "deviceB" },
  { tableId: "T2", start: "2025-06-03 14:00", end: null, deviceId: "device123" }, // 利用中
];

// テーブル状態表示更新関数
function updateTableStatus() {
  const tbody = document.querySelector("#tableStatus tbody");
  tbody.innerHTML = "";
  tables.forEach(t => {
    const tr = document.createElement("tr");
    tr.className = t.status === "vacant" ? "vacant" : "occupied";
    
    // 利用時間計算（分単位）
    let usageTime = "-";
    if (t.status === "occupied" && t.usageStart) {
      const elapsedMs = Date.now() - t.usageStart;
      const m = Math.floor(elapsedMs / 60000);
      usageTime = `${m}分`;
    }
    
    tr.innerHTML = `
      <td>${t.id}</td>
      <td>${t.status === "vacant" ? "空席" : "使用中"}</td>
      <td>${usageTime}</td>
      <td>${t.status === "occupied" ? `<span class="btn-clear" onclick="clearTable('${t.id}')">クリア</span>` : ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

// テーブル使用状態クリア（強制終了用）
function clearTable(tableId) {
  const table = tables.find(t => t.id === tableId);
  if (!table) return;
  if (!confirm(`${tableId}の使用状態をクリアしますか？`)) return;
  
  table.status = "vacant";
  table.usageStart = null;
  table.deviceId = null;
  
  updateTableStatus();
  alert(`${tableId}を空席にしました`);
  // TODO: Firebaseなどに状態更新を反映する処理
}

// 利用履歴表示更新関数
function updateUsageHistory(filterText = "") {
  const tbody = document.querySelector("#usageHistory tbody");
  tbody.innerHTML = "";
  
  // フィルター（テーブルIDか端末ID）
  const filteredLogs = usageLogs.filter(log =>
    log.tableId.includes(filterText) || (log.deviceId && log.deviceId.includes(filterText))
  );
  
  filteredLogs.forEach(log => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${log.tableId}</td>
      <td>${log.start}</td>
      <td>${log.end ? log.end : "利用中"}</td>
      <td>${log.deviceId}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("searchInput").addEventListener("input", e => {
  updateUsageHistory(e.target.value);
});

// 初期表示
updateTableStatus();
updateUsageHistory();

// 利用時間自動更新(1分毎)
setInterval(updateTableStatus, 60 * 1000);

</script>

</body>
</html>





