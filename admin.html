function renderQueue() {
  db.collection("queue").orderBy("timestamp").onSnapshot(snapshot => {
    const allDocs = snapshot.docs;

    // 表示対象: waiting と entered
    const visibleDocs = allDocs.filter(doc => {
      const status = doc.data().status;
      return status === "waiting" || status === "entered";
    });

    const list = document.getElementById("queueList");
    list.innerHTML = "";

    allDocs.forEach((doc, index) => {
      if (!(doc.id in ticketMap)) {
        ticketMap[doc.id] = index + 1;
      }
    });

    visibleDocs.forEach(doc => {
      const data = doc.data();
      const ticketNumber = ticketMap[doc.id] || "?";

      const item = document.createElement("div");
      item.className = "queue-item";
      item.innerHTML = `
        <p><strong>番号札:</strong> ${ticketNumber}</p>
        <p><strong>時刻:</strong> ${formatTime(data.timestamp)}</p>
        <p><strong>状態:</strong> ${data.status}</p>
        <div class="btn-group"></div>
      `;

      const btnGroup = item.querySelector(".btn-group");

      // 入店通知（waiting のときのみ表示）
      if (data.status === "waiting") {
        const btnEnter = document.createElement("button");
        btnEnter.className = "btn-enter";
        btnEnter.textContent = "入店通知";
        btnEnter.onclick = () => {
          db.collection("queue").doc(doc.id).update({ status: "entered" });
        };
        btnGroup.appendChild(btnEnter);
      }

      // 入店確定（entered のときのみ表示）
      if (data.status === "entered") {
        const btnConfirm = document.createElement("button");
        btnConfirm.textContent = "入店確定";
        btnConfirm.style.backgroundColor = "#2980b9";
        btnConfirm.style.color = "white";
        btnConfirm.onclick = () => {
          db.collection("queue").doc(doc.id).update({ status: "confirmed" });
        };
        btnGroup.appendChild(btnConfirm);
      }

      // キャンセル（waiting/entered のとき常に表示）
      if (data.status === "waiting" || data.status === "entered") {
        const btnCancel = document.createElement("button");
        btnCancel.className = "btn-exit";
        btnCancel.textContent = "キャンセル";
        btnCancel.onclick = () => {
          db.collection("queue").doc(doc.id).update({ status: "expired" });
        };
        btnGroup.appendChild(btnCancel);
      }

      list.appendChild(item);
    });
  });
}
